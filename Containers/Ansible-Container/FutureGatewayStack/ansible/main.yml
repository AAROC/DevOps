# This should be your Ansible playbooks to provision your containers.
# An inventory will be automatically created using the names of the services
# from your container.yml file.
# Add any roles or other modules you'll need to this directory too.
# For many examples of roles, check out Ansible Galaxy: https://galaxy.ansible.com/
#

# First play updates the containers
- hosts: api-server,db
  name: Basic setup
  gather_facts: no
  tasks:
  - name: Update Cache
    raw: apt-get update
  - name: Raw ensure python present
    raw: apt-get install -y python python-mysqldb

# - hosts: db
#   name: Basic setup
#   gather_facts: no
#   tasks:
#   - name: Raw ensure python present
#     raw: yum install -y python
#   - name: ensure epel present
#     yum_repository:
#       name: epel
#       description: EPEL repo
#       baseurl: https://ftp.fau.de/epel//7Server/x86_64/
#       state: present
#   - name: ensure python sql bindings present
#     yum:
#       name: MySQL-python
#       state: present
#       update_cache: yes



# Create the database
# - hosts: db
#   name: install db
#   gather_facts: true
#   tasks:
#     - name: include vars
#       include_vars: devel-vars.yml
#
#     - name: Ensure that the data storage is available locally
#       file:
#         path: "{{ sql_data_dir }}"
#         state: directory
#     - name: wait...
#       wait_for:
#         host: "{{ hostvars['db']['ansible_default_ipv4']['address'] }}"
#         port: 3306
#         state: present
#         timeout: 300
#
#     - name: Ensure  that the db is present
#       mysql_db:
#         name: fgapiserver
#         #login_host: "{{ db_config.ansible_facts.ansible_docker_container.NetworkSettings.IPAddress }}"
#         login_host: "{{ hostvars['db']['ansible_default_ipv4']['address'] }}"
#         login_user: root
#         login_password: "{{ db_root_password }}"
#         state: import
#         target: "{{ lookup('env','PWD')}}/roles/fgapi-db/files/fgapiserver_db.sql"
#       retries: 3



# install FG API server
# - hosts: api-server
#   roles:
#     - fgapiserver-role


# install FG BackEnd.
# - hosts: gridengine
#   roles:
#     - gridengine
