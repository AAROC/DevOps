<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Home - AAROC DevOps</title>
  

  <link rel="shortcut icon" href="../../../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../../../css/highlight.css">
  <link href="../../../../site/css/base.css" rel="stylesheet">
  <link href="../../../../site/css/bootstrap-custom.min.css" rel="stylesheet">
  <link href="../../../../site/css/font-awesome-4.0.3.css" rel="stylesheet">
  <link href="../../../../site/css/highlight.css" rel="stylesheet">
  <link href="../../../../site/site/css/base.css" rel="stylesheet">
  <link href="../../../../site/site/css/bootstrap-custom.min.css" rel="stylesheet">
  <link href="../../../../site/site/css/font-awesome-4.0.3.css" rel="stylesheet">
  <link href="../../../../site/site/css/highlight.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Home";
    var mkdocs_page_input_path = "Roles/Ansible/playbooks/top-bdii/index.md";
    var mkdocs_page_url = "/Roles/Ansible/playbooks/top-bdii/";
  </script>
  
  <script src="../../../../js/jquery-2.1.1.min.js"></script>
  <script src="../../../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../../../js/highlight.pack.js"></script>
  <script src="../../../../js/theme.js"></script> 
  <script src="../../../../site/js/base.js"></script>
  <script src="../../../../site/js/bootstrap-3.0.3.min.js"></script>
  <script src="../../../../site/js/highlight.pack.js"></script>
  <script src="../../../../site/js/jquery-1.10.2.min.js"></script>
  <script src="../../../../site/mkdocs/js/lunr-0.5.7.min.js"></script>
  <script src="../../../../site/mkdocs/js/mustache.min.js"></script>
  <script src="../../../../site/mkdocs/js/require.js"></script>
  <script src="../../../../site/mkdocs/js/search.js"></script>
  <script src="../../../../site/mkdocs/js/text.js"></script>
  <script src="../../../../site/site/js/base.js"></script>
  <script src="../../../../site/site/js/bootstrap-3.0.3.min.js"></script>
  <script src="../../../../site/site/js/highlight.pack.js"></script>
  <script src="../../../../site/site/js/jquery-1.10.2.min.js"></script>
  <script src="../../../../site/site/mkdocs/js/lunr-0.5.7.min.js"></script>
  <script src="../../../../site/site/mkdocs/js/mustache.min.js"></script>
  <script src="../../../../site/site/mkdocs/js/require.js"></script>
  <script src="../../../../site/site/mkdocs/js/search.js"></script>
  <script src="../../../../site/site/mkdocs/js/text.js"></script>

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../../.." class="icon icon-home"> AAROC DevOps</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../../Playbooks/">Playbooks</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../../Services/">Services</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Roles</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../">Home</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Ansible</span></li>

        
            
    <ul class="subnav">
    <li><span>Playbooks</span></li>

        
            
    <ul class="subnav">
    <li><span>Top bdii</span></li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Home</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#the-top-bdii-playbook">The Top-BDII playbook.</a></li>
                
            
                <li class="toctree-l3"><a href="#plays">Plays</a></li>
                
            
            </ul>
        
    </li>

        
    </ul>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Roles</span></li>

        
            
    <ul class="subnav">
    <li><span>Ansible executor</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/ansible-executor/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Apache web server</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/apache-web-server/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Bootstrap</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/bootstrap/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Boundary monitor</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/boundary-monitor/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Container bootstrap</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/container-bootstrap/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Cvmfs</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/cvmfs/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Cvmfs static</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/cvmfs-static/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Discourse sso</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/discourse-sso/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Emi ui</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/emi-ui/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Emi worker node</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/emi-worker-node/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Fmarco76</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/fmarco76.IDPPublic/">Home</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/fmarco76.firewall/">Home</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/fmarco76.tomcat/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Geerlingguy</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/geerlingguy.repo-epel/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Glassfish</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/glassfish/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Head node</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/head-node/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Jenkins 2</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/jenkins-2.0/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Jenkins slave</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/jenkins-slave/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Ldap</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/ldap/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Liferay csgf</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/liferay-csgf/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Liferay gridengine</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/liferay-gridengine/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Liferay mysql</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/liferay-mysql/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Mysql</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/mysql/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Perun slave</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/perun-slave/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Shibboleth idp</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/shibboleth-idp/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Shibboleth sp</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/shibboleth-sp/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Site bdii tests</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/site-bdii-tests/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Slack nagios</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/slack-nagios/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Top bdii</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/top-bdii/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Umd</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/umd/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Umd3</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/umd3/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Worker node</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/worker-node/">Home</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Xrootd</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roles/xrootd/">Home</a>
        
    </li>

        
    </ul>

        
    </ul>

        
    </ul>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../..">AAROC DevOps</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../..">Docs</a> &raquo;</li>
    
      
        
          <li>Playbooks &raquo;</li>
        
      
        
          <li>Top bdii &raquo;</li>
        
      
    
    <li>Home</li>
    <li class="wy-breadcrumbs-aside">
      
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="the-top-bdii-playbook">The Top-BDII playbook.</h1>
<p>The <code>top-bdii.yml</code> playbook is used to deploy the <a href="http://www.eu-emi.eu/products/-/asset_publisher/1gkD/content/bdii-top-2">Top-BDII</a>.</p>
<h1 id="plays">Plays</h1>
<pre><code>- hosts: top-bdiis
  name: BDII_TOP plays
  pre_tasks:
    - debug:
        msg: &quot;Site is  {{ site_name }}&quot;
      tags:
        - debug
</code></pre>

<p>This is a helper task to see if the <code>{{ site_name }}</code> variable has been picked up correctly. This is usually stored in <code>{{ group_vars/&lt;site-name&gt; }}</code> where <code>&lt;site_name&gt;</code> is the name of the site as registered in the GOCDB.</p>
<pre><code>    - name: Tell the team
      slack:
        domain: africa-arabia-roc.slack.com
        token: {{ slack_token }}
        msg: &quot;Running top-bdii play at on {{ ansible_hostname }} at {{ site_name }}&quot;
        username: &quot;Ansible on {{ ansible_hostname }} at {{ site_name }}&quot;
        validate_certs: False
      tags:
        - slack
</code></pre>

<p>Ansible will tell the team in a channel on Slack what is happening. The variables are provided via files in <code>group_vars</code></p>
<pre><code>  roles:
    - { role: common, become: true }
    - { role: certificates, become: true }
    - { role: umd, become: true, tags: &quot;umd&quot; }
    - { role: top-bdii, become: true }
    - { role: yaim, become: true }
</code></pre>

<p>The playbook applies - in order - the 5 necessary roles. The <code>top-bdii</code> role ensures that the correct packages are installed and tha the firewall on the target machine has been properly configured to allow communication via port 2170. The <code>yaim</code> role is applied in order to ensure that the right configuration is generated via templates and the execution of the configuration via yaim is performed. See the <a href="../../roles/yaim/index.md"><code>yaim</code> role</a> for more information.</p>
<pre><code>  post_tasks:
    - name: Start BDII if PID but Process dead.
      become: true
      service:
        name: bdii
        state: restarted
      tags:
        - testing
</code></pre>

<p>Post tasks are applied once yaim has completed :</p>
<ol>
<li>Ensure that the bdii service is restarted.</li>
</ol>
<pre><code>  vars_files:
    - &quot;roles/common/vars/distros/{{ ansible_distribution }}-{{ ansible_distribution_version }}.yml&quot;
    - roles/common/vars/middleware/IGTF.yml
</code></pre>

<p>Variables necessary for this playbook, which are not provided by the role itself are pulled in from the common role. See the <a href="../../roles/common/index.md"><code>common</code> role</a> role for more information.</p>
<pre><code>  handlers:
    - include: roles/common/handlers/main.yml
</code></pre>

<p>The handler from the common role is pulled in, in order to </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../roles/ansible-executor/" class="btn btn-neutral float-right" title="Home">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../../" class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../../" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../roles/ansible-executor/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
