---
- hosts: discourse-forum
  name: Get the required roles
  tasks:
  - name: check if the required roles are present
    stat: $HOME/ansible/roles/dochang.docker
    register: dochang_present

  - name: get the docker role from galaxy
    raw: ansible-galaxy install -p roles dochang.docker
    when: ! dochang_present.stat.isdir

- hosts: discourse-forum
  name: Make the host dockable
  sudo: true
  roles:
    - dochang.docker

- hosts: discourse-forum
  name: Deploy Discourse with Apache and federated logon
  roles:
    - apache-web-server
    - shibboleth-sp
    - discourse-sso
