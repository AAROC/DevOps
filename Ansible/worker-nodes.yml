# worker nodes playbook
# this assumes that you've already run the bootstrap role as root.
--- 
- hosts: worker-nodes
  name: add head node ansible user key to authorized_keys
  assemble: src=~/.ssh/id.rsa.pub dest=/home/ansible/.ssh/authorized_keys owner=ansible:ansible mode=400 remote_src=False
  tags:
    - bootstrap
    - keys


- hosts: worker-nodes
  name: Prepare worker nodes
  user: ansible
  sudo: true
  roles:
    - worker-node


- hosts: worker-nodes
  name: Apply the common role and CA certs
  user: ansible
  sudo: true
  roles:
    - common
    - certificates
  vars_files:
    - roles/common/vars/distros/{{ ansible_distribution }}-{{ ansible_distribution_version }}.yml
    - roles/common/vars/middleware/igtf.yml

- hosts: worker-nodes 
  name: install middleware
  user: ansible
  sudo: true
  roles:
    - umd
    - emi-worker-node

- hosts: worker-nodes
  name: configure middleware with yaim
  user: ansible
  sudo: true
  roles:
    - yaim

#- hosts: worker-nodes
