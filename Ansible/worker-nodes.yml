# worker nodes playbook
# this assumes that you've already run the bootstrap role as root.
--- 
- hosts: cluster-head-nodes
  name: run the head node role on the head node
  connection: local
  sudo: true
  roles:
  - head-node

- hosts: cluster-head-nodes
  name: Look up local facts and create key vars file
  connection: local
  tasks: 
  - setup:
  - debug: msg="key is {{ ansible_ssh_host_key_rsa_public }} "
  - local_action: lineinfile dest=roles/worker-node/vars/public_keys.yml line="public_keys{{':'}} ssh-rsa {{ ansible_ssh_host_key_rsa_public }} ansible@{{ ansible_hostname }}" state=present create=yes

- hosts: worker-nodes
  name: Prepare worker nodes for installation
  user: ansible
  roles:
    - worker-node
    - common
    - certificates
  vars_files:
    - roles/common/vars/distros/{{ ansible_distribution }}-{{ ansible_distribution_version }}.yml
    - roles/common/vars/middleware/igtf.yml

- hosts: worker-nodes 
  name: Install middleware
  user: ansible
  sudo: true
  roles:
    - umd
    - emi-worker-node

- hosts: worker-nodes
  name: configure middleware with yaim
  user: ansible
  sudo: true
  roles:
    - yaim

#- hosts: worker-nodes
