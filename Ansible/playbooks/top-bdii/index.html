<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	<title>Home - AAROC DevOps</title>

        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <link href="../../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../../..">AAROC DevOps</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../../..">Home</a>
                </li>
            
            
            
                <li >
                    <a href="../../../CONTRIBUTING/">CONTRIBUTING</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Ansible <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../">Home</a>
</li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Playbooks</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../">Home</a>
</li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Top bdii</a>
    <ul class="dropdown-menu">
        
            
<li class="active">
    <a href="./">Home</a>
</li>

        
    </ul>
  </li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Roles</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/">Home</a>
</li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Ansible executor</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/ansible-executor/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Apache web server</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/apache-web-server/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Bootstrap</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/bootstrap/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Boundary monitor</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/boundary-monitor/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Container bootstrap</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/container-bootstrap/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Cvmfs</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/cvmfs/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Cvmfs static</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/cvmfs-static/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Discourse sso</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/discourse-sso/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Emi ui</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/emi-ui/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Emi worker node</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/emi-worker-node/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Fmarco76</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/fmarco76.IDPPublic/">Home</a>
</li>

        
            
<li >
    <a href="../../roles/fmarco76.firewall/">Home</a>
</li>

        
            
<li >
    <a href="../../roles/fmarco76.tomcat/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Geerlingguy</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/geerlingguy.repo-epel/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Glassfish</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/glassfish/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Head node</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/head-node/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Jenkins 2</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/jenkins-2.0/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Jenkins slave</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/jenkins-slave/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Ldap</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/ldap/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Liferay csgf</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/liferay-csgf/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Liferay gridengine</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/liferay-gridengine/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Liferay mysql</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/liferay-mysql/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Mysql</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/mysql/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Perun slave</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/perun-slave/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Shibboleth idp</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/shibboleth-idp/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Shibboleth sp</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/shibboleth-sp/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Site bdii tests</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/site-bdii-tests/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Slack nagios</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/slack-nagios/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Top bdii</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/top-bdii/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Umd</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/umd/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Umd3</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/umd3/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Worker node</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/worker-node/">Home</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Xrootd</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../roles/xrootd/">Home</a>
</li>

        
    </ul>
  </li>

        
    </ul>
  </li>

                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../../roles/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/AAROC/DevOps">
                        
                        Edit on Github
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#the-top-bdii-playbook">The Top-BDII playbook.</a></li>
        
    
        <li class="main "><a href="#plays">Plays</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="the-top-bdii-playbook">The Top-BDII playbook.</h1>
<p>The <code>top-bdii.yml</code> playbook is used to deploy the <a href="http://www.eu-emi.eu/products/-/asset_publisher/1gkD/content/bdii-top-2">Top-BDII</a>.</p>
<h1 id="plays">Plays</h1>
<pre><code>- hosts: top-bdiis
  name: BDII_TOP plays
  pre_tasks:
    - debug:
        msg: &quot;Site is  {{ site_name }}&quot;
      tags:
        - debug
</code></pre>

<p>This is a helper task to see if the <code>{{ site_name }}</code> variable has been picked up correctly. This is usually stored in <code>{{ group_vars/&lt;site-name&gt; }}</code> where <code>&lt;site_name&gt;</code> is the name of the site as registered in the GOCDB.</p>
<pre><code>    - name: Tell the team
      slack:
        domain: africa-arabia-roc.slack.com
        token: {{ slack_token }}
        msg: &quot;Running top-bdii play at on {{ ansible_hostname }} at {{ site_name }}&quot;
        username: &quot;Ansible on {{ ansible_hostname }} at {{ site_name }}&quot;
        validate_certs: False
      tags:
        - slack
</code></pre>

<p>Ansible will tell the team in a channel on Slack what is happening. The variables are provided via files in <code>group_vars</code></p>
<pre><code>  roles:
    - { role: common, become: true }
    - { role: certificates, become: true }
    - { role: umd, become: true, tags: &quot;umd&quot; }
    - { role: top-bdii, become: true }
    - { role: yaim, become: true }
</code></pre>

<p>The playbook applies - in order - the 5 necessary roles. The <code>top-bdii</code> role ensures that the correct packages are installed and tha the firewall on the target machine has been properly configured to allow communication via port 2170. The <code>yaim</code> role is applied in order to ensure that the right configuration is generated via templates and the execution of the configuration via yaim is performed. See the <a href="../../roles/yaim/index.md"><code>yaim</code> role</a> for more information.</p>
<pre><code>  post_tasks:
    - name: Start BDII if PID but Process dead.
      become: true
      service:
        name: bdii
        state: restarted
      tags:
        - testing
</code></pre>

<p>Post tasks are applied once yaim has completed :</p>
<ol>
<li>Ensure that the bdii service is restarted.</li>
</ol>
<pre><code>  vars_files:
    - &quot;roles/common/vars/distros/{{ ansible_distribution }}-{{ ansible_distribution_version }}.yml&quot;
    - roles/common/vars/middleware/IGTF.yml
</code></pre>

<p>Variables necessary for this playbook, which are not provided by the role itself are pulled in from the common role. See the <a href="../../roles/common/index.md"><code>common</code> role</a> role for more information.</p>
<pre><code>  handlers:
    - include: roles/common/handlers/main.yml
</code></pre>

<p>The handler from the common role is pulled in, in order to </p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>