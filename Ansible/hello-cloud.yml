---
# small playbook to talk to OpenStack and make machines
- hosts: localhost
  tasks:
    - name: get the cloud information
      os_client_config:
    - name: flava flava !
      os_flavor_facts:
    # - name: tell us bout the flava !
    #   debug:
    #     var: openstack_flavors
    - name: "What's your name, flava ?"
      debug:
        var: item
      with_items: "{{ openstack_flavors | json_query('[*].name') }}"
    - name: Create a VM
      os_server:
        name: batman_vm
        state: absent
        image: CentOS7
        image_exclude: deprecated
        flavor_ram: 4096
        # userdata: |
        #                     #cloud-config
        #                     phone_home:
        #                       url: https://hooks.slack.com/services/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
        #                       post: [ {"channel": "#devops-foundry", "username": "webhookbot", "text": "I'm alive, bitches" ]
        userdata: |
                            #cloud-config
                            packages:
                              - curl
                            runcmd:
                              - [ curl -X POST --data-urlencode 'payload={"channel": "#devops-foundry", "username": "Ansible", "text": "I'm ALIVE  BITCHES", "icon_emoji": ":batman:"}' https://hooks.slack.com/services/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 ]
      register: newhost
    - name: Password, newcomer !
      debug:
        var: newhost.openstack.adminPass
    - name: Where my homies at ?
      debug:
        var: newhost.openstack.interface_ip
# now you have openstack.clouds !
# - name: Get the list of images
