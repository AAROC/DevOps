---
#- hosts: site-bdiis
#  name: Bootstrap the machine
#  vars_files:
#    - "roles/common/vars/distros/{{ ansible_distribution }}-{{ ansible_distribution_version }}.yml"
#    - roles/common/vars/middleware/IGTF.yml
#    - "group_vars/passwords-{{ site_name }}.yml"
#  roles:
#   - { role: bootstrap, become: true }

- hosts: site-bdiis
  name: Configure the machine
  pre_tasks:
    - debug:
        msg: "site is {{ site_name }}"
      tags:
        - debug
    - name: Tell the team
      slack:
        domain: africa-arabia-roc.slack.com
        token: V4qyCjHMRUb9ZmNdcf2hVEmI
        msg: "Starting the site-bdii play for {{ inventory_hostname }} !"
        username: "Ansible on {{ ansible_hostname }} at {{ site_name }}"
      tags:
        - slack
  vars_files:
    - "roles/common/vars/distros/{{ ansible_distribution }}-{{ ansible_distribution_version }}.yml"
    - roles/common/vars/middleware/IGTF.yml
#    - "group_vars/passwords-{{ site_name }}.yml"
  roles:
    - { role: common, become: true }
    - { role: umd, become: true }
    - { role: site-bdii, become: true }
    - { role: yaim, become: true, emi_service: BDII_site}
  post_tasks:
    - name: Tell the team
      slack:
        domain: africa-arabia-roc.slack.com
        token: V4qyCjHMRUb9ZmNdcf2hVEmI
        msg: "The site-bdii play for {{ inventory_hostname }} !"
        username: "Ansible on {{ ansible_hostname }} at {{ site_name }}"
      tags:
        - slack

- name: Tests
  hosts: site-bdiis
  roles:
    - site-bdii-tests
