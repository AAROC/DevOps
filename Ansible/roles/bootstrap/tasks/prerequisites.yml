---
# - name: check DNS
#   command: host www.google.com
#   register: hosttest
#   changed_when: false
#   failed_when: false

- name: use Google public DNS if necessary
  lineinfile:
    dest: /etc/resolv.conf
    regexp: '^nameserver'
    line: 'nameserver 8.8.8.8'
#  when: "'ping: unknown host www.google.com' in hosttest.stderr"
  tags:
    - DNS
- name: update the repo configuration
  copy:
    src: etc/yum.repos.d/sl6x.repo
    dest: /etc/yum.repos.d/sl6x.repo
  #        validate: 'yum update'

- name: ensure that SELinux python bindings are installed
  yum:
    name: libselinux-python
    state: installed

- name: debug packages
  debug:
    var: "bootstrap_prerequisites.{{ ansible_os_family }}"

- name: Install prerequisite packages (RedHat)
  yum:
    name: "{{ item }}"
    state: present
  with_items: "bootstrap_prerequisites.{{ ansible_os_family }}"
  tags:
    - bootstrap
  when: ansible_os_family=="RedHat"

- name: Install prerequisite packages (Debian)
  apt:
    name: "{{ item }}"
    state: present
  with_items: "{{ bootstrap_prerequisites[ansible_os_family]}}"
  tags:
    - bootstrap
  when: ansible_os_family=="Debian"
