---   
- name: Copy modules file LDIF
  copy: src=etc/openldap/slapd.d/{{ ldap_module_file }} dest=/tmp/{{ ldap_module_file }}
  sudo: yes
  tags: 
    - LDAP
    - config

- name: Add modules
  command: ldapmodify -Y EXTERNAL ldapi:/// -f /tmp/{{ ldap_module_file }}
  sudo: yes 
  when: ansible_os_family == 'Debian'
  tags: 
    - LDAP
    - config
 
- name: Restart ldap server
  service: name={{ ldap_service }} state=restarted enabled=yes
  sudo: yes 
  tags: 
    - LDAP
    - config
 
- name: Add Password Policy to ldap server
  copy: src=etc/openldap/slapd.d/ppolicy.ldif dest=/tmp/ppolicy.ldif
  tags: 
    - LDAP
    - config
  
- name:  Create hdb LDIF 
  template: src=db.ldif.j2 dest=/tmp/db.ldif
  tags: 
    - LDAP
    - config
    
- name: Create User and Group Overlay LDIF
  copy: src=etc/openldap/slapd.d/overlay.ldif dest=/tmp/overlay.ldif
  tags: 
    - LDAP
    - config

