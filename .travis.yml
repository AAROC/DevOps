language: bash
sudo: required
services: docker
env:
  - INVENTORY=inventory.travis
# The bootstrap role will always be tested
  - BOOSTRAP_CONTAINER=aaroc/code-rade-sl6-ansible
  - BOOSTRAP_CONTAINER=aaroc/code-rade-u1404-ansible
# Add the containers you need for the services you want to test here
  - SITE_BDII_CONTAINER="aaroc/site-bdii:centos6.8"

before_install:
# Pull the containers you need for the tests
  - docker pull $BOOTSTRAP_CONTAINER
  - docker pull $SITE_BDII_CONTAINER
install:
  - cd $TRAVIS_BUILD_DIR/Ansible
  - chmod 400 $PWD/roles/bootstrap/files/public_keys/*
# basic connectivity test
  - docker run -h localhost.dev -v $PWD:$PWD -w $PWD $BOOTSTRAP_CONTAINER ansible all -c local -vvvvv -i inventories/$INVENTORY -m ping
# Test Bootstrap role
  - docker run -h localhost.dev -v $PWD:$PWD -w $PWD $BOOTSTRAP_CONTAINER ansible all -c local -vvvvv -i inventories/$INVENTORY -m ping
# Test Site-BDII playbook
  - docker run -h localhost.dev -v $PWD:$PWD -w $PWD $SITE_BDII_CONTAINER ansible-playbook -c local -i inventories/$INVENTORY -e "emi_service=BDII_site yaim_options='-n BDII_site'" site-bdiis.yml
notifications:
  slack:
    rooms:
      - africa-arabia-roc:8bySc6HbbEvvxPYqg0Z56Xdk#code
